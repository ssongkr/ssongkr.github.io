---
title: "작성중인 포스팅입니다."
layout: post
# tags: ['로드밸런싱', '클러스터링']
tags: ['ING']
subtitle: '로드밸런싱과 클러스터링에 대해 학습한다.'
---


## 들어가며
---
[웹 캐시](https://ssongkr.github.io/2020/05/23/what-is-a-web-cache.html)의 개념과 종류에 대해서 포스팅하면서 잠시 로드밸런서를 언급하였다. 자주 들어봤던 용어지만 자세하게 알지 못하는 개념이기 때문에 이번 포스팅을 통해 정리해보고자 한다.


&nbsp;
## 로드 밸런싱(Load Balancing)이란?
---
로드 밸런싱은 여러 서버에 작업을 분산시켜 웹 사이트, 애플리케이션, 데이터베이스 및 기타 서비스의 성능과 안정성을 향상시키는데 사용되는 고가용성(HA, High Availability) 인프라의 핵심 구성 요소다.

> 인프라의 고가용성(highly-available)이란 서버와 네트워크, 프로그램 등의 정보 시스템이 오랜 기간 동안 지속적으로 정상 운영이 가능한 성질을 말한다.


로드 밸런싱이 없는 웹의 인프라는 아래와 같은 형태를 보일 것이다.

![no-load-balancing](/images/no-load-balancing.png)

위 예제에서 사용자는 `yourdomain.com`의 웹 서버에 직접 연결한다. 단일 웹 서버이기 때문에 서버가 다운된다면 사용자는 더 이상 웹 사이트에 접근할 수 없게 된다. 또한 다수의 사용자가 서버에 동시에 접근한다면 서버는 요청을 빠르게 처리할 수 없을 것이다. 따라서 로드 시간이 매우 느릴 것이고, 최악의 경우 서버에 연결하지 못할 수도 있다.

단일 장애점(single point of failure)은 로드 밸런서와 추가적인 웹 서버를 백엔드에 도입하여 완화시킬 수 있다. 일반적으로 모든 백엔드 서버는 사용자에게 동일한 컨텐츠를 제공한다. 따라서 어떤 서버가 응답하는지 여부에 상관없이 사용자들은 일관된 컨텐츠를 받을 것이다.

> 단일 장애점(single point of failure)은 시스템의 구성 요소 중에서, 동작하지 않으면 전체 시스템이 중단되는 요소를 말한다.

![with-load-balancer](/images/with-load-balancer.png)

위 예제에서 사용자는 로드 밸런서에 접근(access)한다. 그리고 로드 밸런서는 사용자의 요청을 백엔드 서버에 전달하고, 백엔드 서버는 사용자의 요청에 직접 응답한다. 위 그림에는 오직 한 개의 로드 밸런서만 존재하기 때문에, 로드 밸런서가 단일 장애점이 된다. 두번째 로드 밸런서를 도입하여 문제를 완화할 수 있지만, 이에 대해 논의하기 전에 로드 밸런서의 작동 방식을 먼저 살펴보자.


&nbsp;
## 로드 밸런서의 서버 선택 방법
---
로드 밸런서는 두 가지 요소의 조합을 기반으로 어떤 서버에 요청을 전달할지 선택한다.
먼저 로드 밸런서는 그들이 선택할 수 있는 서버가 실제로 요청에 적절하게 응답하는지 확인한다. 그리고 사전에 정의된 규칙에 따라 상태 풀에서 서버를 선택한다.

&nbsp;
### Health Check
로드 밸런서는 오직 정상적인 백엔드 서버에만 트래픽을 전달해야한다. 백엔드 서버의 상태를 모니터링하기 위해 health checks는 주기적으로 백엔드 서버에 연결을 시도한다. 프로토콜을 사용하고 forwarding rules에 의해 정의된 포트를 사용하여 서버가 listening하고 있는지 확인하기 위해서. 만역 서버가 상태 확인에 실패한다면 그래서 요청을 처리할 수 없다면 이것은 자동으로 풀에서 제거되고, 트래픽이 그 서버로 전달되지 않을 것이다. 헬스체크를 다시 응답하기 전까지는.

&nbsp;
### 로드 밸런싱 알고리즘
사용되는 로드 밸런싱 알고리즘에 따라 정상 서버중 어떤 서버가 선택될 지 결정된다. 일반적으로 사용되는 알고리즘은 다음과 같다.

#### 라운드 로빈 (Round Robin)
라운드 로빈은 서버가 순차적으로 선택되는 알고리즘이다. 로드 밸런서는 첫번째 요청에 대해 서버의 목록 중 첫번째 서버를 선택할 것이다. 그리고 서버 목록의 순서대로 선택하고, 마지막에 다다르면 다시 첫번째 서버를 선택할 것이다.

#### Least Connections
Least Connections는 최소한의 커넥션을 가지고 있는 서버를 로드 밸런서가 선택할 것이라는 것을 뜻하고, 트래픽으로 인해 세션이 길어 때 권장하는 방식이다. 

#### Source
소스 알고리즘의 경우 로드 밸런서는 사용할 서버를 선택한다. 요청의 소스 IP의 해시를 기반으로. 방문자의 IP 주소와 같은. 이 방법은 특정한 사용자가 동일한 서버에 일관되게 연결할 수 있다.

&nbsp;
### 어떻게 로드 밸런서가 상태를 다루는가?
일부 애플리케이션은 사용자가 동일한 서버에 연결하는 것을 필요로 한다. 소스 알고리즘은 클라이언트의 IP 정보에 기반하여 선호도를 생성한다. 이를 달성하는 또 다른 방식은 웹 애플리케이션에서 고정 세션을 사용하는 것이다. 여기에서 로드 밸런서는 쿠키를 설정하고 해당 세션의 모든 요청을 동일한 물리 서버로 보낸다.


&nbsp;
## 중복 로드 밸런서(Redundant Load Balancers)
---
로드 밸런서의 장애 단일점을 제거하기 위해 두 번째 로드 밸런서를 첫 번째 로드 밸런서에 연결하여 클러스터를 형성할 수 있다. 서로가 모니터링한다 서로의 상태를. 각각은 장애 감지 및 복구를 할 수 있다.

![redundant-load-balancers](/images/redundant-load-balancers.png)

메인 로드 밸런서에 장애가 발생하면 DNS는 사용자를 두번째 로드 밸런서로 안내 해야 한다.

DNS의 변경은 인터넷에 전파되는데 상당한 시간이 걸리고, 장애 조치를 자동으로 만드는데 많은 시간을 소요할 수 있기 떄문에 많은 관리자는 시스템을 사용한다. 유동적인 IP 주소를 다시 매핑할수 있는. floating IP 주소 같은. 


 DNS 변경 사항을 인터넷에 전파하고이 장애 조치를 자동으로 만드는 데 상당한 시간이 걸릴 수 있기 때문에 많은 관리자는 유동 IP와 같은 유연한 IP 주소 다시 매핑을 허용하는 시스템을 사용합니다. 주문형 IP 주소 다시 매핑은 필요할 때 쉽게 다시 매핑 할 수있는 고정 IP 주소를 제공하여 DNS 변경 고유의 전파 및 캐싱 문제를 제거합니다. 도메인 이름은 동일한 IP 주소와 연결된 상태로있을 수 있지만 IP 주소 자체는 서버간에 이동됩니다.


## 출처
- https://ko.wikipedia.org/wiki/%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0
- https://www.digitalocean.com/community/tutorials/what-is-load-balancing#how-does-the-load-balancer-choose-the-backend-server
- https://goodgid.github.io/Load-Balancing-And-Clustering/
- https://m.blog.naver.com/PostView.nhn?blogId=limoremo&logNo=220519009798&proxyReferer=https:%2F%2Fwww.google.com%2F
- https://ko.wikipedia.org/wiki/%EB%8B%A8%EC%9D%BC_%EC%9E%A5%EC%95%A0%EC%A0%90
- https://nesoy.github.io/articles/2018-06/Load-Balancer